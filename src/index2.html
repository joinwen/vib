<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Scroll</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }
    .box {
      width: 100%;
      padding: 1rem;
      line-height: 1.5;
      background: rgba(200,200,200,.3);
      box-sizing: border-box;
    }
    .loading {
      border-bottom: 0px solid green;
      height: 0px;
    }
  </style>
</head>
<body>
<div class="loading"></div>
  <div class="box">
    假如从广东乡下找一个没有历练的人
    他没有练习过观察力
    要观察，先要经过思索和读书
    学会泛揽
    专读书也有弊病，
    必须得和社会有所接触，和所读的书活起来

    长妈妈，已经说过，是一个一向带领着我的女工，说得阔气一点，就是我的保姆。我的母亲和许多别的人都这样称呼她，似乎略带些客气的意思。只有祖母叫她阿长。我平时叫她“阿妈”，连“长”字也不带；但到憎恶她的时候，——例如知道了谋死我那隐鼠的却是她的时候，就叫她阿长。
    　　我们那里没有姓长的；她生得黄胖而矮，“长”也不是形容词。又不是她的名字，记得她自己说过，她的名字是叫作什么姑娘的。什么姑娘，我现在已经忘却了，总之不是长姑娘；也终于不知道她姓什么。记得她也曾告诉过我这个名称的来历：先前的先前，我家有一个女工，身材生得很高大，这就是真阿长。后来她回去了，我那什么姑娘才来补她的缺，然而大家因为叫惯了，没有再改口，于是她从此也就成为长妈妈了。
    长妈妈生得那么胖，一定很怕热罢？晚上的睡相，怕不见得很好罢？……”
    　　母亲听到我多回诉苦之后，曾经这样地问过她。我也知道这意思是要她多给我一些空席。她不开口。但到夜里，我热得醒来的时候，却仍然看见满床摆着一个“大”字，一条臂膊还搁在我的颈子上。我想，这实在是无法可想了。
    　　但是她懂得许多规矩；这些规矩，也大概是我所不耐烦的。一年中最高兴的时节，自然要数除夕了。辞岁之后，从长辈得到压岁钱，红纸包着，放在枕边，只要过一宵，便可以随意使用。睡在枕上，看着红包，想到明天买来的小鼓、刀枪、泥人、糖菩萨……。然而她进来，又将一个福橘放在床头了。
    　　“哥儿，你牢牢记住！”她极其郑重地说。“明天是正月初一，清早一睁开眼睛，第一句话就得对我说：‘阿妈，恭喜恭喜！’记得么？你要记着，这是一年的运气的事情。不许说别的话！说过之后，还得吃一点福橘。”她又拿起那橘子来在我的眼前摇了两摇，“那么，一年到头，顺顺流流……。”
    　　梦里也记得元旦的，第二天醒得特别早，一醒，就要坐起来。她却立刻伸出臂膊，一把将我按住。我惊异地看她时，只见她惶急地看着我。
    　　她又有所要求似的，摇着我的肩。我忽而记得了——

  </div>
  <script>
    const maxY = 80,
      data = {};
    let box = document.querySelector(".box"),
      loading = document.querySelector(".loading");

    function setStyle(ele, obj) {
      let key = Object.keys(obj)[0],
        value = obj[key];
      ele.style[key] = value;
    }

    function getStyle(ele, key) {
      return window.getComputedStyle(ele)[key];
    }

    function throttle(fn, delay) {
      let timer = null;
      return function() {
        clearTimeout(timer);
        args = Array.prototype.slice.call(arguments);
        timer = setTimeout(() => {
          fn.apply(null, args);
        }, delay)
      }
    }
    function debounce(fn, delay) {
      let flag = true;
      return function() {
        if(!flag)
          return
        flag = false;
        let args = Array.prototype.slice.call(arguments);
        setTimeout(() => {
          fn.apply(null, args);
          flag = true;
        }, delay)
      }
    }
    const strategy = {
      // arctan 函数处理
      arctan: (val, y) => {
        const k = 20;    // k 为摩擦系数，越小，越好拖拽
        let M = y *  (2 / Math.PI),
          N = Math.PI / (maxY * k)
        return Math.atan(val * N) * M;
      },
      // 原始不处理
      nothing: (val) => {
        return val;
      }
    };
    function listenTouch() {
      box.addEventListener("touchstart", (e) => {
        // e.preventDefault();
        let event = e.touches[0];
        data.start = event.pageY;
      })
      box.addEventListener("touchmove", (e) => {
        // console.log("touchmove", e);
        let pageY = e.touches[0].pageY,
          moveY = pageY - data.start;
        // if(moveY > 0) {
          moveY = strategy.arctan(moveY, 2 * maxY);
          console.log(moveY);
          setStyle(loading, {"border-bottom": `${moveY}px solid green`})
        // }

      })
      box.addEventListener("touchend", (e) => {
        setStyle(loading, {"border-bottom": `${0}px solid green`});
      })
      box.addEventListener("touchcancel", (e) => {
        setStyle(loading, { "border-bottom": `{0}px solid green`})
      })
    }
    listenTouch();
  </script>
</body>
</html>
